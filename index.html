<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª</title>
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="icon" type="image/png" href="https://cdn-icons-png.flaticon.com/512/3081/3081920.png">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/3081/3081920.png">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª">

    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

    <style>
        body { background-color: #f4f4f4; font-family: 'Cairo', sans-serif; margin: 0; padding: 0; }
        input, select { box-sizing: border-box; outline: none; }
        .container { max-width: 450px; margin: auto; padding: 10px; background: #fdfdfd; min-height: 100vh; }
        button:active { transform: scale(0.98); }
        .order-card { background: white; padding: 15px; margin-bottom: 12px; border-radius: 18px; box-shadow: 0 4px 12px rgba(0,0,0,0.06); display: flex; justify-content: space-between; align-items: center; }
        .missing-card { background: #fff8f8; padding: 12px; margin-bottom: 10px; border-radius: 12px; border-right: 8px solid #c0392b; display: flex; justify-content: space-between; align-items: center; }
    </style>
</head>
<body>

    <audio id="notifSound" src="https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3"></audio>

    <div class="container">

        <div id="noticeBoard" onclick="updateNotice()" style="background: linear-gradient(135deg, #fff3cd 0%, #ffeeba 100%); border: 2px dashed #856404; padding: 15px; border-radius: 15px; margin-bottom: 20px; text-align: center; font-weight: bold; color: #856404; cursor: pointer;">
            Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©...
        </div>

        <button id="lockBtn" onclick="unlockOrders()" style="width: 100%; padding: 12px; background: #34495e; color: white; border: none; border-radius: 12px; margin-bottom: 15px; font-weight: bold; cursor: pointer;">Ø§Ù†Ù‚Ø± Ù„ÙØªØ­ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</button>

        <div id="orderForm" style="display: none; background: white; padding: 20px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.08); margin-bottom: 25px; border-top: 8px solid #e67e22;">
            <h2 style="color: #e67e22; margin-top: 0; text-align: center; font-size: 22px;">ØªØ³Ø¬ÙŠÙ„ Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯</h2>

            <input type="text" id="item" placeholder="Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù..." style="width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid #ddd; border-radius: 12px;">
            
            <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                <input type="number" id="amount" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ©" style="flex: 2; padding: 12px; border: 1px solid #ddd; border-radius: 12px;">
                <select id="unit" style="flex: 1; padding: 12px; border: 1px solid #ddd; border-radius: 12px;">
                    <option>Ù‚Ø·Ø¹Ø©</option>
                    <option>ÙƒÙŠÙ„Ùˆ</option>
                    <option>Ù„ØªØ±</option>
                    <option>Ø¨Ù„Ø§ÙƒØ©</option>
                </select>
            </div>

            <input type="text" id="details" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ: ...)" style="width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid #ddd; border-radius: 12px; background: #fffcf0;">

            <select id="chef" style="width: 100%; padding: 12px; margin-bottom: 20px; border: 1px solid #ddd; border-radius: 12px;">
                <option value="Ù…Ø¹Ø§Ø°">Ø§Ù„Ø´ÙŠÙ Ù…Ø¹Ø§Ø°</option>
                <option value="Ù…Ù†Ø§Ù">Ø§Ù„Ø´ÙŠÙ Ù…Ù†Ø§Ù</option>
                <option value="Ø­Ø³ÙŠÙ†">Ø§Ù„Ø´ÙŠÙ Ø­Ø³ÙŠÙ†</option>
            </select>

            <button onclick="sendToFirebase()" style="width: 100%; padding: 18px; background: #e67e22; color: white; border: none; border-radius: 15px; font-size: 18px; font-weight: bold; box-shadow: 0 5px 15px rgba(230, 126, 34, 0.3); cursor: pointer;">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø¢Ù†</button>
            <button onclick="lockOrders()" style="width: 100%; background: none; color: #7f8c8d; border: none; margin-top: 10px; cursor: pointer; font-size: 14px;">Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬</button>
        </div>

        <h3 style="color: #2c3e50; border-right: 6px solid #e67e22; padding-right: 12px; margin-bottom: 15px;">Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø©</h3>
        <div id="liveOrders"></div>

        <hr style="margin: 30px 0; border: 0; border-top: 1px solid #eee;">

        <div style="background: #fff; padding: 20px; border-radius: 20px; border-top: 8px solid #c0392b; box-shadow: 0 10px 25px rgba(0,0,0,0.08);">
            <h3 style="color: #c0392b; margin-top: 0;">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù†ÙˆØ§Ù‚Øµ</h3>
            <div style="display: flex; gap: 8px;">
                <input type="text" id="missingItem" placeholder="Ù…Ø§ Ø§Ù„Ø°ÙŠ ÙŠÙ†Ù‚ØµÙ†Ø§ØŸ" style="flex: 3; padding: 12px; border: 1px solid #ddd; border-radius: 12px;">
                <button onclick="sendMissingToFirebase()" style="flex: 1; background: #c0392b; color: white; border: none; border-radius: 12px; font-weight: bold; cursor: pointer;">Ø¥Ø¶Ø§ÙØ©</button>
            </div>
            <div id="missingList" style="margin-top: 20px;"></div>
        </div>
    </div>

<script>
        var config = {
          apiKey: "AIzaSyAMTWxOCru9c8KOFRrQiFsvJ-52D8IxrPw",
          authDomain: "abujoud95.firebaseapp.com",
          projectId: "abujoud95",
          storageBucket: "abujoud95.firebasestorage.app",
          messagingSenderId: "85673334000",
          appId: "1:85673334000:web:707a2bfbd8e2ec6b11de35"
        };

        if (!firebase.apps.length) { firebase.initializeApp(config); }
        var db = firebase.firestore();

        var audio = document.getElementById('notifSound');
        var isAudioEnabled = false;

        window.addEventListener('click', function() {
            if (!isAudioEnabled) {
                audio.play().then(() => {
                    audio.pause();
                    audio.currentTime = 0;
                    isAudioEnabled = true;
                });
            }
        }, { once: true });

        function playNotification() {
            if (audio && isAudioEnabled) {
                audio.currentTime = 0;
                audio.play();
            }
            if (navigator.vibrate) {
                navigator.vibrate([200, 100, 200]); // ğŸ“³ Ø§Ù‡ØªØ²Ø§Ø²
            }
        }

        var firstLoad = true;

        window.sendToFirebase = function() {
          var it = item.value.trim();
          var am = amount.value.trim();
          if(!it || !am) return;

          db.collection("orders").add({
            item: it,
            amount: am,
            unit: unit.value,
            details: details.value,
            chef: chef.value,
            timestamp: firebase.firestore.FieldValue.serverTimestamp()
          });

          item.value = "";
          amount.value = "";
          details.value = "";
        };

        db.collection("orders").orderBy("timestamp", "desc").onSnapshot(function(snap) {
          liveOrders.innerHTML = "";

          if (!firstLoad && !snap.metadata.hasPendingWrites) {
              playNotification();
          }
          firstLoad = false;

          snap.forEach(function(doc) {
            var d = doc.data();
            liveOrders.innerHTML += `
              <div class="order-card">
                <div><b>${d.item}</b> - ${d.amount} ${d.unit}</div>
                <button onclick="db.collection('orders').doc('${doc.id}').delete()">ØªÙ…</button>
              </div>`;
          });
        });

        // ======== Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ÙˆØ­ÙŠØ¯ Ù‡Ù†Ø§ ========
        var firstMissingLoad = true;

        window.sendMissingToFirebase = function() {
          var mi = missingItem.value.trim();
          if(mi) {
              db.collection("missing").add({
                  name: mi,
                  timestamp: firebase.firestore.Timestamp.now()
              });
              missingItem.value = "";
          }
        };

        db.collection("missing").orderBy("timestamp", "desc").onSnapshot(function(snap) {
          missingList.innerHTML = "";

          if (!firstMissingLoad && !snap.metadata.hasPendingWrites) {
              playNotification(); // ğŸ”Š + ğŸ“³ Ù„Ù„Ù†ÙˆØ§Ù‚Øµ
          }
          firstMissingLoad = false;

          snap.forEach(function(doc) {
            missingList.innerHTML += `
              <div class="missing-card">
                <span>Ù†Ù‚Øµ: ${doc.data().name}</span>
                <button onclick="db.collection('missing').doc('${doc.id}').delete()">ØªÙ…</button>
              </div>`;
          });
        });
</script>

</body>
</html>
